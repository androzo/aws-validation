{"format_version":"1.2","terraform_version":"1.5.6","variables":{"account_number":{"value":"***"},"environment":{"value":"devl"},"region":{"value":"sa-east-1"},"team_name":{"value":"team-drozer"}},"planned_values":{"root_module":{"resources":[{"address":"aws_iam_policy.deployment_policy","mode":"managed","type":"aws_iam_policy","name":"deployment_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Policy granting access to resources tagged with Team=team-drozer","name":"team-drozer-deployment-policy","path":"/","policy":"{\"Statement\":[{\"Action\":\"s3:*\",\"Condition\":{\"StringEquals\":{\"aws:RequestTag/team\":\"team-drozer\"}},\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"s3:ListBucket\",\"Condition\":{\"StringEquals\":{\"s3:ResourceTag/team\":\"team-drozer\"}},\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":{"Name":"team-drozer-deployment-policy","environment":"devl"},"tags_all":{"Name":"team-drozer-deployment-policy","environment":"devl"}},"sensitive_values":{"tags":{},"tags_all":{}}},{"address":"aws_iam_role.deployment_role","mode":"managed","type":"aws_iam_role","name":"deployment_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"token.actions.githubusercontent.com:aud\":\"sts.amazonaws.com\"},\"StringLike\":{\"token.actions.githubusercontent.com:sub\":\"repo:androzo/team-drozer-*:*devl\"}},\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::***:oidc-provider/token.actions.githubusercontent.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"team-drozer-deployment-role","path":"/","permissions_boundary":"arn:aws:iam::***:policy/team-drozer-deployment-permission-boundary","tags":{"Name":"team-drozer-deployment-role","environment":"devl"},"tags_all":{"Name":"team-drozer-deployment-role","environment":"devl"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags":{},"tags_all":{}}},{"address":"aws_iam_role_policy_attachment.attach_deployment_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"attach_deployment_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"team-drozer-deployment-role"},"sensitive_values":{}}]}},"resource_changes":[{"address":"aws_iam_policy.deployment_policy","mode":"managed","type":"aws_iam_policy","name":"deployment_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Policy granting access to resources tagged with Team=team-drozer","name":"team-drozer-deployment-policy","path":"/","policy":"{\"Statement\":[{\"Action\":\"s3:*\",\"Condition\":{\"StringEquals\":{\"aws:RequestTag/team\":\"team-drozer\"}},\"Effect\":\"Allow\",\"Resource\":\"*\"},{\"Action\":\"s3:ListBucket\",\"Condition\":{\"StringEquals\":{\"s3:ResourceTag/team\":\"team-drozer\"}},\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":{"Name":"team-drozer-deployment-policy","environment":"devl"},"tags_all":{"Name":"team-drozer-deployment-policy","environment":"devl"}},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name_prefix":true,"policy_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"tags":{},"tags_all":{}}}},{"address":"aws_iam_role.deployment_role","mode":"managed","type":"aws_iam_role","name":"deployment_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRoleWithWebIdentity\",\"Condition\":{\"StringEquals\":{\"token.actions.githubusercontent.com:aud\":\"sts.amazonaws.com\"},\"StringLike\":{\"token.actions.githubusercontent.com:sub\":\"repo:androzo/team-drozer-*:*devl\"}},\"Effect\":\"Allow\",\"Principal\":{\"Federated\":\"arn:aws:iam::***:oidc-provider/token.actions.githubusercontent.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"team-drozer-deployment-role","path":"/","permissions_boundary":"arn:aws:iam::***:policy/team-drozer-deployment-permission-boundary","tags":{"Name":"team-drozer-deployment-role","environment":"devl"},"tags_all":{"Name":"team-drozer-deployment-role","environment":"devl"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags":{},"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags":{},"tags_all":{}}}},{"address":"aws_iam_role_policy_attachment.attach_deployment_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"attach_deployment_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"team-drozer-deployment-role"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{}}}],"prior_state":{"format_version":"1.0","terraform_version":"1.5.6","values":{"root_module":{"resources":[{"address":"data.aws_iam_policy.permissions_boundary","mode":"data","type":"aws_iam_policy","name":"permissions_boundary","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"arn":"arn:aws:iam::***:policy/team-drozer-deployment-permission-boundary","attachment_count":0,"description":"Permissions boundary for deployment role","id":"arn:aws:iam::***:policy/team-drozer-deployment-permission-boundary","name":"team-drozer-deployment-permission-boundary","path":"/","path_prefix":null,"policy":"{\"Statement\":[{\"Action\":\"*\",\"Condition\":{\"StringNotEquals\":{\"aws:ResourceTag/team\":\"team-drozer\"}},\"Effect\":\"Deny\",\"Resource\":\"*\"},{\"Action\":[\"iam:Delete*\",\"iam:UpdateAssumeRolePolicy\",\"iam:PutRolePermissionsBoundary\",\"organizations:*\",\"account:*\"],\"Effect\":\"Deny\",\"Resource\":\"*\",\"Sid\":\"DenyDangerousActions\"},{\"Action\":\"iam:PassRole\",\"Condition\":{\"ArnNotLikeIfExists\":{\"aws:PrincipalArn\":\"arn:aws:iam::*:role/team-drozer-deployment-role\"},\"StringNotLike\":{\"iam:PassedToService\":[\"ec2.amazonaws.com\",\"lambda.amazonaws.com\",\"ecs-tasks.amazonaws.com\"]}},\"Effect\":\"Deny\",\"Resource\":\"*\",\"Sid\":\"ConditionalPassRole\"}],\"Version\":\"2012-10-17\"}","policy_id":"ANPAVYV5ZVSS6LNBGNRUX","tags":{"Name":"team-drozer-deployment-permission-boundary","team":"devops"}},"sensitive_values":{"tags":{}}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws"}},"root_module":{"resources":[{"address":"aws_iam_policy.deployment_policy","mode":"managed","type":"aws_iam_policy","name":"deployment_policy","provider_config_key":"aws","expressions":{"description":{"references":["var.team_name"]},"name":{"references":["var.team_name"]},"policy":{"references":["var.team_name","var.team_name"]},"tags":{"references":["var.team_name","var.environment"]}},"schema_version":0},{"address":"aws_iam_role.deployment_role","mode":"managed","type":"aws_iam_role","name":"deployment_role","provider_config_key":"aws","expressions":{"assume_role_policy":{"references":["var.account_number","var.team_name","var.environment"]},"name":{"references":["var.team_name"]},"permissions_boundary":{"references":["data.aws_iam_policy.permissions_boundary.arn","data.aws_iam_policy.permissions_boundary"]},"tags":{"references":["var.team_name","var.environment"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.attach_deployment_policy","mode":"managed","type":"aws_iam_role_policy_attachment","name":"attach_deployment_policy","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.deployment_policy.arn","aws_iam_policy.deployment_policy"]},"role":{"references":["aws_iam_role.deployment_role.name","aws_iam_role.deployment_role"]}},"schema_version":0,"depends_on":["aws_iam_policy.deployment_policy","aws_iam_role.deployment_role"]},{"address":"data.aws_iam_policy.permissions_boundary","mode":"data","type":"aws_iam_policy","name":"permissions_boundary","provider_config_key":"aws","expressions":{"arn":{"references":["var.account_number","var.team_name"]}},"schema_version":0}],"variables":{"account_number":{},"environment":{},"region":{},"team_name":{}}}},"relevant_attributes":[{"resource":"data.aws_iam_policy.permissions_boundary","attribute":["arn"]},{"resource":"aws_iam_policy.deployment_policy","attribute":["arn"]},{"resource":"aws_iam_role.deployment_role","attribute":["name"]}],"timestamp":"2025-04-13T19:15:40Z"}